<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ì§„ë‹¨ê²°ê³¼</title>
        <link rel="stylesheet" href="result.css" />
    </head>
    <body>
        <header>
            <div id="logo" onclick="to_main()">
                <img src="./image/asopi_logo.png" alt="ë¡œê³ " width="100%" />
            </div>
            <div id="mypage_logo" onclick="to_mypage()">
                <img src="./image/mypage_icon.png" alt="ë§ˆì´í˜ì´ì§€ ì•„ì´ì½˜" width="100%" />
            </div>
        </header>
        <main class="result">
            <section id="image">
                <div id="diagnosis_result">
                    <h2>ê°ì§€í•œ ë³‘ë³€</h2>
                    <img id="resultImage" src="" alt="ì§„ë‹¨ ì´ë¯¸ì§€" />
                </div>
            </section>
            <br />
            <section id="result">
                <div id="title">
                    <p id="result-title">ì§„ë‹¨ ê²°ê³¼</p>
                    <p id="diseaseDisplay" style="font-size: 25px"></p>
                </div>
                <div id="result_contents">
                    <div id="child_info">
                        <span
                            id="childNameDisplay"
                            style="font-size: 15px; margin-right: 25px; margin-left: 15px"
                        ></span>
                        <span id="childAgeDisplay" style="font-size: 15px"></span>
                    </div>
                    <br />
                    <p id="description">ì •ì˜ğŸ“–</p>
                    <p id="descriptionDisplay" style="margin-bottom: 40px"></p>
                    <p id="symptom">ì¦ìƒğŸ”</p>
                    <p id="symptomDisplay"></p>
                </div>
            </section>
            <br />
            <br />
            <div id="map_button">
                <button class="map_button" type="button" onclick="to_map()">ì§‘ ê·¼ì²˜ ë³‘ì› ë³´ëŸ¬ ê°€ê¸°</button>
            </div>
            <div id="return_button">
                <button class="return_button" type="button" onclick="to_main()">ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°</button>
            </div>
        </main>
        <script src="script.js"></script>
        <script>
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ img ìš”ì†Œì— í‘œì‹œí•˜ê³  ì •ë³´ ì½ì–´ì˜¤ê¸°
            window.onload = async function () {
                try {
                    var imageUrl = localStorage.getItem('uploadedImage');
                    if (imageUrl) {
                        document.getElementById('resultImage').src = imageUrl;
                    }
                    // ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ í™”ë©´ì— í‘œì‹œ
                    const userData = await fetchUserDataFromLocalStorage();
                    displayUserData(userData);
                } catch (error) {
                    console.error('Error:', error);
                }
            };

            // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì •ë³´ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            async function fetchUserDataFromLocalStorage() {
                const childName = localStorage.getItem('childName') || 'ì •ë³´ ì—†ìŒ'; /*ì•„ì´ ì´ë¦„*/
                const childAge = localStorage.getItem('childAge') || 'ì •ë³´ ì—†ìŒ'; /*ì•„ì´ ë‚˜ì´*/
                const disease = localStorage.getItem('disease') || 'ì •ë³´ ì—†ìŒ'; /*ì§ˆí™˜ëª…*/
                // descriptionê³¼ symptomì—ì„œ ê°œí–‰ ë¬¸ì(\n)ë¥¼ <br> íƒœê·¸ë¡œ ë³€í™˜
                const description = (localStorage.getItem('description') || 'ì •ë³´ ì—†ìŒ').replace(/\n/g, '<br>');
                const symptom = (localStorage.getItem('symptom') || 'ì •ë³´ ì—†ìŒ').replace(/\n/g, '<br>');
                return {
                    childName: childName,
                    childAge: childAge,
                    disease: disease,
                    description: description,
                    symptom: symptom,
                };
            }

            // ì‚¬ìš©ì ì •ë³´ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
            function displayUserData(userData) {
                document.getElementById('childNameDisplay').textContent = 'ì•„ì´ ì´ë¦„ : ' + userData.childName;
                document.getElementById('childAgeDisplay').textContent = 'ì•„ì´ ë‚˜ì´ : ' + userData.childAge;
                document.getElementById('diseaseDisplay').textContent = userData.disease; /*ì§ˆí™˜ëª…*/
                // descriptionê³¼ symptomì— ëŒ€í•´ ë”°ì˜´í‘œì™€ ê°œí–‰ ë¬¸ìë¥¼ ì§€ìš°ê³  <br> íƒœê·¸ë¡œ ë³€í™˜í•˜ì—¬ HTMLë¡œ í‘œì‹œ
                document.getElementById('descriptionDisplay').innerHTML = userData.description
                    .replace(/\\n|"/g, '')
                    .replace(/\n/g, '<br>');
                document.getElementById('symptomDisplay').innerHTML = userData.symptom
                    .replace(/\\n|"/g, '')
                    .replace(/\n/g, '<br>');
            }
            // ì‚¬ìš©ìê°€ í™•ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
            function to_main() {
                window.location.href = 'http://localhost:3000/';
            }
            function to_mypage() {
                window.location.href = 'mypage.html';
            }
            function to_map() {
                window.location.href = 'map.html';
            }
            function sendTokenAndEmailToBackend() {
                // ì‚¬ìš©ìì˜ í† í°ê³¼ ì´ë©”ì¼ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const userToken = localStorage.getItem('userToken');
                const userEmail = 'ì‚¬ìš©ìì˜ ì´ë©”ì¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•'; // ì‚¬ìš©ìì˜ ì´ë©”ì¼ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
                // Ajaxë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— í† í°ê³¼ ì´ë©”ì¼ì„ ì „ì†¡
                $.ajax({
                    type: 'POST',
                    url: 'í† í°ê³¼ì´ë©”ì¼ì„ë³´ë‚´ëŠ”ì—”ë“œí¬ì¸íŠ¸', // ì‹¤ì œ ì„œë²„ URLë¡œ ëŒ€ì²´ í•„ìš”
                    data: { token: userToken, email: userEmail },
                    success: function (response) {
                        console.log('ì„œë²„ ì‘ë‹µ:', response);
                        // ì„œë²„ ì‘ë‹µì— ë”°ë¼ ì¶”ê°€ì ì¸ ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥
                    },
                    error: function (error) {
                        console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                    },
                });
            }
        </script>
    </body>
</html>
